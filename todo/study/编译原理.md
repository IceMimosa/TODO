# 编译原理

[TOC]

学习地址：https://www.bilibili.com/video/av17649289

# 1. 绪论

## 1.1 什么是编译

`高级语言`(High Level Language) -> `汇编语言`(Assembly Language) -> `机器语言`(Machine Language)

* 机器语言 (C706 0000 0002)
	* 可被计算机直接理解
	* 与人类表达习惯相距甚远
	* 难记忆、难编写、难阅读
* 汇编语言 (MOV X,2)
	* 引入助记符
	* 依赖于特定计算机，非计算机专业人员使用受限
	* 编写效率已然很低
* 高级语言 (x = 2)
	* 类似于数学定义或自然语言的简写形式
	* 不依赖于特定机器
	* 编写效率高

汇编(Compiling): 汇编语言 -> 机器语言
编译(Assembling): 高级语言 -> 汇编语言(机器语言)

> 编译: 将`高级语言(源语言)`翻译成`汇编语言或者机器语言(目标语言)`的过程

--- 

* 编译器处在的位置

源程序 -> `预处理器` -> 经过处理的源程序 -> `编译器` -> 汇编语言程序 -> `汇编器` -> 可重定位的机器代码 -> `链接器/加载器` -> 目标机器代码

预处理器: 把存储在不同文件中的程序`聚合`在一起，把被称为`宏`的缩写语句转换为原始语句
可重定位: 在内存中存放的起始位置L不是固定的 (起始地址 + 相对地址 = 绝对地址)
加载器: 修改可重定位地址，将修改后的指令和数据放到内存的适当位置
链接器: 将多个可重定位的机器代码文件(包括库文件)连接到一起，并解决外部地址的问题

## 1.2 编译系统的结构

* 基本结构

源语言句子 -> `分析源语言` -> 句子的语义 -> `生成目标语言` -> 目标语言句子

分析源语言: 以分析英语到中文为例

![](http://ice-img.pigutu.com/2019-03-02-143556.png)


* 编译器分析的过程

`分析部分/前端`(与源语言相关): 

1、字符流 -> `词法分析器` -> 词法单元流 -> `语法分析器` -> 语法树 -> `语义分析器` -> 语法树 -> `中间代码生成器` -> 中间表示形式

2、中间表示形式 -> `机器无关代码优化器` -> 中间表示形式

`综合部分/后端`(与目标语言相关):

3、中间表示形式 -> `目标代码生成器` -> 目标机器语言 -> `机器相关代码优化器` -> 目标机器语言

## 1.3 词法分析

从左向右逐行扫描源程序的字符，识别出各个单词，确定`单词类型`。
将识别出的单词转换成统一的`机内表示` -- 词法单元(token)形式

token: <种别码, 属性值>

![](http://ice-img.pigutu.com/2019-03-02-145004.png)

 
## 1.4 语法分析

从词法分析器输出的token序列中`识别出各类短语`, 并`构造语法分析树`。语法分析树描述了句子的语法结构。

![](http://ice-img.pigutu.com/2019-03-02-145832.png)
![](http://ice-img.pigutu.com/2019-03-02-145923.png)

## 1.5 语义分析

* 收集标识符的属性信息
	* 种属(Kind): 简单变量、符合变量、过程、...
	* 类型(Type): 整型、实型、字符型、布尔型、至指针型、...
	* 存储位置、长度
	* 值
	* 作用域
	* 参数和返回值: 参数个数、参数类型、参数传递方式、返回值类型、...
* 语义检查
	* 变量或过程`未经声明就使用`
	* 变量或过程名`重复声明`
	* `运算分量`类型不匹配
	* 操作符与操作数之间的类型不匹配：如数组下标不是整数、过程调用的参数类型或数据不匹配、函数返回类型有错误等

## 1.6 中间代码生成

* 三地址码（Three-address Code）
	* 由`类似于汇编语言`的指令序列组成，每个指令`最多有三个操作符`
* 语法结构树/语法树（Syntax Trees）

> 三地址指令表示

![](http://ice-img.pigutu.com/2019-03-02-153000.png)

* 四元式（Quadruples）
	* (op,y,x,z)
* 三元式（Triples）
* 间接三元式（Indirect triples）

![](http://ice-img.pigutu.com/2019-03-02-153555.png)

![](http://ice-img.pigutu.com/2019-03-02-154028.png)


## 1.7 目标代码生成

* 目标代码生成以源程序的`中间表示形式`作为输入，并将它映射到`目标语言`
* 目标代码生成的一个重要任务是为程序中使用的变量`合理分配寄存器`

## 1.8 代码优化

为改进代码所进行的`等价程序变化`，使其`运行得更快`一些、`占用空间更少`一些，或者`二者兼顾`

# 2. 词法语法分析




